{
  "version": "2.0.0",
  "tasks": [
    {
      "label": "build and run main",
      "type": "shell",
      "command": "g++",
      "args": [
        "-std=c++17",
        "-I./include",
        "main.cpp",
        "-o",
        "main",
        "-lboost_system",
        "-pthread",
        "&&",
        "./main"
      ],
      "group": "build",
      "problemMatcher": []
    },
    {
      "label": "build and run tcp_client",
      "type": "shell",
      "command": "g++",
      "args": [
        "-std=c++17",
        "-I./include",
        "xtcp_client.cpp",
        "ocpp_model.cpp",
        "-o",
        "xtcp_client",
        "-lboost_system",
        "-pthread",
        "&&",
        "./xtcp_client"
      ],
      "group": "build",
      "problemMatcher": []
    },
    {
      "label": "build and run tcp_server",
      "type": "shell",
      "command": "g++",
      "args": [
        "-std=c++17",
        "-I./include",
        "tcp_server.cpp",
        "ocpp_model.cpp",
        "router.cpp",
        "-o",
        "tcp_server",
        "-lboost_system",
        "-pthread",
        "&&",
        "./tcp_server"
      ],
      "group": "build",
      "problemMatcher": []
    },
    {
      "label": "build router tests",
      "type": "shell",
      "command": "g++",
      "args": [
        "-std=c++17",
        "-g",
        "-O0",
        "-I", "${workspaceFolder}/include",
        "${workspaceFolder}/tests/test_router.cpp",
        "${workspaceFolder}/router.cpp",
        "${workspaceFolder}/ocpp_model.cpp",
        "-o", "${workspaceFolder}/tests/test_router",
        "-pthread"
      ],
      "group": { "kind": "build", "isDefault": false }
    },
    {
        "label": "build and run router tests",
        "type": "shell",
        "command": "g++",
        "args": [
            "-std=c++17",
            "-I./include",
            "tests/test_router.cpp",
            "router.cpp",
            "ocpp_model.cpp",
            "${workspaceFolder}/tests/test_server.cpp",
            "-o",
            "tests/test_router",
            "-pthread",
            "-lboost_system",
            "&&",
            "./tests/test_router"
        ],
        "group": {
            "kind": "build",
            "isDefault": false
        }
    },
    {
        "label": "build and run fake timer tests",
        "type": "shell",
        "command": "g++",
        "args": [
            "-std=c++17",
            "-I./include",
            "${workspaceFolder}/tests/fake_timers.cpp",
            "-o",
            "tests/fake_timers",
            "-lboost_system",
            "-lgtest",
            "-lgtest_main",
            "-pthread",
            "&&",
            "./tests/fake_timers"
        ],
        "group": {
            "kind": "build",
            "isDefault": false
        }
    },
    {
      "label": "build-reconnect (debug)",
      "type": "shell",
      "command": "g++",
      "args": [
        "-std=c++17",
        "-O0", "-g", "-rdynamic",
        "-I", "${workspaceFolder}/include",
        "${workspaceFolder}/tests/test_reconnect.cpp",
        "${workspaceFolder}/router.cpp",
        "${workspaceFolder}/ocpp_model.cpp",
        "${workspaceFolder}/tests/test_server.cpp",
        "-o", "${workspaceFolder}/tests/test_reconnect",
        "-lboost_system",
        "-lgtest",
        "-lgtest_main",
        "-pthread"
      ],
      "group": { "kind": "build", "isDefault": false },
      "problemMatcher": ["$gcc"]
    },
    {
        "label": "build and run reconnect tests",
        "type": "shell",
        "command": "g++",
        "args": [
            "-std=c++17",
            "-I./include",
            "${workspaceFolder}/tests/test_reconnect.cpp",
            "${workspaceFolder}/router.cpp",
            "${workspaceFolder}/ocpp_model.cpp",
            "${workspaceFolder}/tests/test_server.cpp",
            "${workspaceFolder}/tests/test_client.cpp",
            "${workspaceFolder}/tests/test_harness.cpp",
            "-o",
            "tests/test_reconnect",
            "-lboost_system",
            "-lgtest",
            "-lgtest_main",
            "-pthread",
            "&&",
            "./tests/test_reconnect"
        ],
        "group": {
            "kind": "build",
            "isDefault": false
        }
    },
    {
        "label": "build and run session tests",
        "type": "shell",
        "command": "g++",
        "args": [
            "-std=c++17",
            "-I./include",
            "${workspaceFolder}/tests/test_session.cpp",
            "${workspaceFolder}/tests/test_client.cpp",
            "${workspaceFolder}/tests/test_server.cpp",
            "${workspaceFolder}/tests/test_harness.cpp",
            "${workspaceFolder}/router.cpp",
            "${workspaceFolder}/ocpp_model.cpp",
            "-o",
            "tests/test_session",
            "-lboost_system",
            "-lgtest",
            "-lgtest_main",
            "-pthread",
            "&&",
            "./tests/test_session"
        ],
        "group": {
            "kind": "build",
            "isDefault": false
        }
    },
    {
        "label": "build and run e2e tests",
        "type": "shell",
        "command": "g++",
        "args": [
            "-std=c++17",
            "-I./include",
            "${workspaceFolder}/tests/test_e2e.cpp",
            "${workspaceFolder}/tests/test_harness.cpp",
            "${workspaceFolder}/tests/test_server.cpp",
            "${workspaceFolder}/tests/test_client.cpp",
            "${workspaceFolder}/router.cpp",
            "${workspaceFolder}/ocpp_model.cpp",
            "${workspaceFolder}/client_loop.cpp",
            "-o",
            "tests/test_e2e",
            "-lboost_system",
            "-lgtest",
            "-lgtest_main",
            "-pthread",
            "&&",
            "./tests/test_e2e"
        ],
        "group": {
            "kind": "build",
            "isDefault": false
        }
    },
    // {
    //   "label": "build and run e2e tests (clang, -ftime-trace, per-TU objects)",
    //   "type": "shell",
    //   "command": "bash",
    //   "args": [
    //     "-lc",
    //     "set -euo pipefail; \
    //     mkdir -p build/obj; \
    //     CXX=clang++; \
    //     CXXFLAGS='-std=c++17 -O0 -g -I./include -I./tests -pthread -ftime-trace'; \
    //     $CXX $CXXFLAGS -c tests/test_e2e.cpp      -o build/obj/test_e2e.o; \
    //     $CXX $CXXFLAGS -c router.cpp             -o build/obj/router.o; \
    //     $CXX $CXXFLAGS -c ocpp_model.cpp         -o build/obj/ocpp_model.o; \
    //     $CXX $CXXFLAGS -c tests/test_server.cpp  -o build/obj/test_server.o; \
    //     $CXX $CXXFLAGS -c tests/test_client.cpp  -o build/obj/test_client.o; \
    //     $CXX $CXXFLAGS -c tests/test_harness.cpp -o build/obj/test_harness.o; \
    //     $CXX build/obj/test_e2e.o build/obj/router.o build/obj/ocpp_model.o build/obj/test_server.o build/obj/test_client.o build/obj/test_harness.o \
    //           -o tests/test_e2e -lboost_system -lgtest -lgtest_main -pthread; \
    //     ./tests/test_e2e"
    //   ],
    //   "group": { "kind": "build", "isDefault": false },
    //   "problemMatcher": ["$gcc"]
    // },
    {
      "label": "build and run e2e tests (clang, -ftime-trace, per-TU objects)",
      "type": "shell",
      "command": "bash",
      "args": [
        "-lc",
        "set -euo pipefail; set -x; mkdir -p build/obj; clang++ -std=c++17 -O0 -g -I./include -I./tests -pthread -ftime-trace -c tests/test_e2e.cpp -o build/obj/test_e2e.o; clang++ -std=c++17 -O0 -g -I./include -I./tests -pthread -ftime-trace -c router.cpp -o build/obj/router.o; clang++ -std=c++17 -O0 -g -I./include -I./tests -pthread -ftime-trace -c ocpp_model.cpp -o build/obj/ocpp_model.o; clang++ -std=c++17 -O0 -g -I./include -I./tests -pthread -ftime-trace -c tests/test_server.cpp -o build/obj/test_server.o; clang++ -std=c++17 -O0 -g -I./include -I./tests -pthread -ftime-trace -c tests/test_client.cpp -o build/obj/test_client.o; clang++ -std=c++17 -O0 -g -I./include -I./tests -pthread -ftime-trace -c tests/test_harness.cpp -o build/obj/test_harness.o; clang++ build/obj/test_e2e.o build/obj/router.o build/obj/ocpp_model.o build/obj/test_server.o build/obj/test_client.o build/obj/test_harness.o -o tests/test_e2e -lboost_system -lgtest -lgtest_main -pthread; ./tests/test_e2e"
      ],
      "group": { "kind": "build", "isDefault": false },
      "problemMatcher": ["$gcc"]
    },
    {
      "label": "build-and-run-integration-tests",
      "type": "shell",
      "command": "g++",
      "args": [
          "-std=c++17",
          "-I./include",
          "tests/test_server.cpp",
          "router.cpp",
          "ocpp_model.cpp",
          "-o",
          "tests/integration",
          "-lboost_system",
          "-pthread",
          "&&",
          "tests/integration"
      ],
      "group": { "kind": "build", "isDefault": false },
      "presentation": {
        "echo": true,
        "reveal": "always",
        "panel": "shared"
      },
      "problemMatcher": []
    },
    {
      "label": "build-and-run-happy-path (system-gtest)",
      "type": "shell",
      "command": "g++",
      "args": [
        "-std=c++17",
        "-O0", "-g",
        "-I", "${workspaceFolder}/include",
        "-I", "${workspaceFolder}/tests",
        "${workspaceFolder}/router.cpp",
        "${workspaceFolder}/ocpp_model.cpp",
        "${workspaceFolder}/tests/test_server.cpp",
        "${workspaceFolder}/tests/test_happy_path.cpp",
        "-o", "${workspaceFolder}/tests/test_happy_path",
        "-lboost_system",
        "-lgtest",
        "-lgtest_main",
        "-pthread",
        "&&",
        "${workspaceFolder}/tests/test_happy_path"
      ],
      "group": { "kind": "build", "isDefault": false },
      "presentation": { "reveal": "always", "panel": "shared" },
      "problemMatcher": []
    },
    {
      "label": "build-and-debug-happy-path (gdb)",
      "type": "shell",
      "command": "bash",
      "args": [
        "-lc",
        "g++ -std=c++17 -O0 -g -rdynamic -I \"${workspaceFolder}/include\" -I \"${workspaceFolder}/tests\" \"${workspaceFolder}/router.cpp\" \"${workspaceFolder}/ocpp_model.cpp\" \"${workspaceFolder}/tests/test_server.cpp\" \"${workspaceFolder}/tests/test_happy_path.cpp\" -o \"${workspaceFolder}/tests/test_happy_path\" -lboost_system -lgtest -lgtest_main -pthread && gdb --args \"${workspaceFolder}/tests/test_happy_path\""
      ],
      "presentation": { "reveal": "always", "panel": "shared" },
      "group": { "kind": "build", "isDefault": false },
      "problemMatcher": []
    },
    { // add this block
      "label": "build-happy-path",
      "type": "shell",
      "command": "g++",
      "args": [
        "-std=c++17",
        "-O0",
        "-g",
        "-rdynamic",
        "-I", "${workspaceFolder}/include",
        "-I", "${workspaceFolder}/tests",
        "${workspaceFolder}/router.cpp",
        "${workspaceFolder}/ocpp_model.cpp",
        "${workspaceFolder}/tests/test_server.cpp",
        "${workspaceFolder}/tests/test_happy_path.cpp",
        "-o", "${workspaceFolder}/tests/test_happy_path",
        "-lboost_system",
        "-lgtest",
        "-lgtest_main",
        "-pthread"
      ],
      "presentation": { "reveal": "always", "panel": "shared" },
      "problemMatcher": []
    }
  ]
}
